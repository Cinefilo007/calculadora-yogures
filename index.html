<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YogurtBusiness Pro - Gesti√≥n Inteligente</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="shortcut icon" href="icons/icon-192.png" type="image/x-icon">
    <!-- PWA Optimizations iOS/Android v2.7 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</head>

<body>
    <div class="container">
        <!-- Banner de Alerta LocalStorage -->
        <div id="storage-alert" class="alert-banner" style="display: none;">
            <span>‚ö†Ô∏è Datos guardados localmente:</span>
            <p>Si borras el historial o pierdes el m√≥vil, perder√°s tus cuentas y clientes.</p>
            <button id="btn-ver-respaldo" class="btn-link">Ver Respaldo</button>
        </div>

        <header class="animate">
            <h1>üç¶ YogurtBusiness Pro</h1>
            <p id="subtitulo-negocio">Cargando...</p>
            <div id="tasa-bcv-container" class="tasa-bcv">
                <span>BCV:</span>
                <strong id="tasa-valor">...</strong>
                <button id="btn-editar-tasa" class="icon-btn">‚úèÔ∏è</button>
            </div>
        </header>

        <!-- Navegaci√≥n -->
        <nav class="main-nav animate">
            <div class="nav-scroll">
                <button class="nav-btn active" data-tab="calculadora">
                    <span class="icon">üßÆ</span>
                    <small>Calculadora</small>
                </button>
                <button class="nav-btn" data-tab="dashboard">
                    <span class="icon">üìä</span>
                    <small>Mi Panel</small>
                </button>
                <button class="nav-btn" data-tab="inventario">
                    <span class="icon">üì¶</span>
                    <small>Nevera</small>
                </button>
                <button class="nav-btn" data-tab="calendario">
                    <span class="icon">üìÖ</span>
                    <small>Agenda</small>
                </button>
                <button class="nav-btn" data-tab="clientes">
                    <span class="icon">üë•</span>
                    <small>Clientes</small>
                </button>
            </div>
        </nav>

        <main>
            <!-- VISTA: CALCULADORA -->
            <div id="tab-calculadora" class="tab-content active">
                <section class="card animate">
                    <div class="section-header">
                        <h2>üõí Paso 1: Mis Ingredientes</h2>
                        <button type="button" class="info-btn" onclick="UI.mostrarAyuda('insumos')">‚ùì Ayuda</button>
                    </div>
                    <p class="step-guide">Escribe aqu√≠ lo que compraste (leche, az√∫car, vasos, etc.)</p>
                    <form id="form-ingrediente" style="margin-top: 15px;">
                        <input type="hidden" id="ingrediente-id-edit">
                        <div class="form-grid">
                            <div class="input-group">
                                <label>Producto</label>
                                <input type="text" id="nombre-ingrediente" placeholder="Ej: Az√∫car" required>
                            </div>
                            <div class="input-group">
                                <label>Precio Bs</label>
                                <input type="number" id="precio-ingrediente" step="0.01" placeholder="0.00" required>
                            </div>
                            <div class="input-group">
                                <label>Cantidad</label>
                                <div style="display: flex; gap: 4px;">
                                    <input type="number" id="cantidad-ingrediente" placeholder="1000" required
                                        style="flex: 2;">
                                    <select id="unidad-ingrediente" class="unit-selector"
                                        style="flex: 1.5; padding: 10px 5px;">
                                        <option value="g">g</option>
                                        <option value="uni">uni</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">‚ûï A√±adir Insumo</button>
                    </form>
                    <div id="lista-ingredientes" class="list-container"></div>
                    <div id="pag-ingredientes" class="pagination"></div>
                </section>

                <section class="card animate" style="animation-delay: 0.1s;">
                    <div class="section-header">
                        <h2>üë©‚Äçüç≥ Paso 2: Crear la Mezcla</h2>
                        <button type="button" class="info-btn" onclick="UI.mostrarAyuda('mezcla')">‚ùì Ayuda</button>
                    </div>
                    <p class="step-guide">Selecciona qu√© ingredientes usar√°s para tus yogures hoy.</p>
                    <div id="receta-inputs" style="margin-top: 15px;">
                        <div class="form-grid-2">
                            <select id="select-ingrediente">
                                <option value="">Selecci√≥n...</option>
                            </select>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <input type="number" id="uso-cantidad" placeholder="¬øCu√°nto?">
                                <span id="unidad-receta-label" class="unit-badge">g</span>
                            </div>
                        </div>
                        <button id="btn-agregar-receta" class="btn btn-secondary" style="width: 100%;">ü•õ Usar en
                            Mezcla</button>
                    </div>
                    <div id="lista-receta" class="list-container"></div>
                    <hr style="margin: 20px 0; border:0; border-top: 1px solid #EEE;">
                    <div class="form-grid-2">
                        <div class="input-group">
                            <label>Vasos Resultantes</label>
                            <input type="number" id="total-vasos" value="1" min="1">
                        </div>
                        <div class="input-group">
                            <label>Ganancia %</label>
                            <select id="margen-ganancia">
                                <option value="0.30">30%</option>
                                <option value="0.50">50%</option>
                                <option value="1.00">100%</option>
                            </select>
                        </div>
                    </div>
                </section>

                <section class="result-box-pro animate">
                    <div class="row-res">
                        <div><small>INVERSI√ìN:</small> <b id="calc-inversion">0.00 $</b></div>
                        <div><small>GANANCIA:</small> <b id="calc-ganancia" style="color:#2ECC71;">0.00 $</b></div>
                    </div>
                    <div class="main-price">
                        <span id="resultado-bs">0,00</span> <small>Bs</small>
                        <div class="sub-usd">‚âà <span id="resultado-usd">0.00</span> $</div>
                    </div>
                    <button id="btn-a√±adir-inventario" class="btn btn-success"
                        style="width: 100%; font-size: 1.1rem;">üì¶ Paso 3: Guardar Yogurt para Vender</button>
                </section>
            </div>

            <!-- VISTA: DASHBOARD -->
            <div id="tab-dashboard" class="tab-content">
                <section class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <h2>üìä Resultados</h2>
                        <div class="chart-controls">
                            <button id="btn-chart-prev" class="icon-btn">‚óÄÔ∏è</button>
                            <span id="label-periodo" style="font-weight: 600; font-size: 0.85rem;">...</span>
                            <button id="btn-chart-next" class="icon-btn">‚ñ∂Ô∏è</button>
                            <select id="select-chart-vista" style="width: auto; padding: 4px 5px; font-size: 0.75rem;">
                                <option value="mes">Mes</option>
                                <option value="a√±o">A√±o</option>
                            </select>
                        </div>
                    </div>
                    <div class="stats-grid-pro">
                        <div class="stat-item">
                            <small>Vendido</small>
                            <div id="dash-ventas-totales">0.00 $</div>
                        </div>
                        <div class="stat-item">
                            <small>En Deuda</small>
                            <div id="dash-por-cobrar" style="color: var(--fresa);">0.00 $</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; height: 220px;">
                        <canvas id="chart-ventas"></canvas>
                    </div>
                    <button id="btn-nueva-venta-dash" class="btn btn-primary" style="width: 100%; margin-top: 20px;">üí∞
                        Registrar Venta Directa</button>
                    <div id="ultimas-ventas" class="list-container" style="margin-top: 20px;"></div>
                    <div id="pag-ventas" class="pagination"></div>
                </section>
            </div>

            <!-- VISTA: INVENTARIO -->
            <div id="tab-inventario" class="tab-content">
                <section class="card">
                    <div class="section-header">
                        <h2>üì¶ Mi Nevera (Stock)</h2>
                        <button type="button" class="info-btn" onclick="UI.mostrarAyuda('inventario')">‚ùì Ayuda</button>
                    </div>
                    <div class="stats-grid-pro" style="margin-bottom: 20px;">
                        <div class="stat-item">
                            <small>Valor Stock</small>
                            <div id="inv-valor-total">0.00 $</div>
                        </div>
                        <div class="stat-item">
                            <small>Ganancia Potencial</small>
                            <div id="inv-ganancia-total" style="color: #2ECC71;">0.00 $</div>
                        </div>
                    </div>
                    <div id="lista-inventario" class="list-container"></div>
                    <div id="pag-inventario" class="pagination"></div>
                </section>
            </div>

            <!-- VISTA: CALENDARIO -->
            <div id="tab-calendario" class="tab-content">
                <section class="card">
                    <div class="section-header">
                        <h2>üìÖ Mi Agenda de Cobros</h2>
                        <button type="button" class="info-btn" onclick="UI.mostrarAyuda('agenda')">‚ùì Ayuda</button>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div class="calendar-nav">
                            <button id="btn-cal-prev" class="icon-btn">‚óÄÔ∏è</button>
                            <span id="label-mes-calendario" style="font-weight: 600; font-size: 0.9rem;">...</span>
                            <button id="btn-cal-next" class="icon-btn">‚ñ∂Ô∏è</button>
                        </div>
                    </div>
                    <div id="calendario-grid" class="calendar-grid"></div>
                    <div id="deudas-dia-seleccionado" class="list-container" style="margin-top: 20px;"></div>
                </section>
            </div>

            <!-- VISTA: CLIENTES -->
            <div id="tab-clientes" class="tab-content">
                <section class="card">
                    <h2>üë• Agenda de Clientes</h2>
                    <form id="form-cliente" class="form-grid-2">
                        <input type="text" id="nombre-cliente" placeholder="Nombre" required>
                        <input type="text" id="tel-cliente" placeholder="WhatsApp" required>
                        <button type="submit" class="btn btn-primary" style="grid-column: span 2;">‚ûï Guardar
                            Cliente</button>
                    </form>
                    <div id="lista-clientes" class="list-container"></div>
                    <div id="pag-clientes" class="pagination"></div>
                </section>
            </div>
        </main>

        <footer class="main-footer animate">
            <p><strong>YogurtBusiness Pro</strong> v2.7</p>
            <p>Desarrollado por: <strong>Samuel Rojas</strong></p>
            <div class="footer-links">
                <a href="https://wa.me/584245762885" target="_blank" class="whatsapp-badge">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA"> Contacto
                </a>
            </div>
        </footer>
    </div>

    <!-- MODALES -->

    <!-- MODAL: A√ëADIR AL INVENTARIO -->
    <div id="modal-inventario" class="modal" style="display: none;">
        <div class="modal-content animate">
            <div class="modal-header">
                <h2>üì¶ Guardar en Nevera</h2>
                <button onclick="UI.cerrarModal('modal-inventario')" class="btn-close">‚úñÔ∏è</button>
            </div>
            <form id="form-guardar-inventario">
                <div class="input-group">
                    <label>Nombre del Producto</label>
                    <input type="text" id="inv-nombre" placeholder="Ej: Yogurt Vaso 7oz Fresa" required>
                </div>
                <div class="form-grid-2">
                    <div class="input-group">
                        <label>Cantidad</label>
                        <input type="number" id="inv-cantidad" readonly>
                    </div>
                    <div class="input-group">
                        <label>Precio Unitario ($)</label>
                        <input type="number" id="inv-precio" step="0.01" required>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success">‚úÖ Confirmar</button>
                    <button type="button" onclick="UI.cerrarModal('modal-inventario')" class="btn btn-link"
                        style="color:var(--texto)">Regresar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: REGISTRAR VENTA -->
    <div id="modal-venta" class="modal" style="display: none;">
        <div class="modal-content animate">
            <div class="modal-header">
                <h2>üí∞ Registrar Venta</h2>
                <button onclick="UI.cerrarModal('modal-venta')" class="btn-close">‚úñÔ∏è</button>
            </div>
            <form id="form-venta">
                <div class="input-group">
                    <label>Cliente</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="venta-cliente" required style="flex:1"></select>
                        <button type="button" onclick="UI.abrirModal('modal-cliente-rapido')" class="btn btn-secondary"
                            style="padding:10px; font-size:1.2rem; display:flex; align-items:center; justify-content:center; color:white;">
                            <span style="color:var(--crema); font-weight:800; font-size:24px; line-height:1;">+</span>
                        </button>
                    </div>
                </div>
                <div class="input-group">
                    <label>Producto</label>
                    <select id="venta-producto" required></select>
                </div>
                <div class="form-grid-2">
                    <div class="input-group">
                        <label>Cantidad</label>
                        <input type="number" id="venta-cantidad" value="1" min="1" required>
                    </div>
                    <div class="input-group">
                        <label>M√©todo</label>
                        <select id="venta-tipo">
                            <option value="contado">Al Contado</option>
                            <option value="credito">A Cr√©dito</option>
                        </select>
                    </div>
                </div>
                <div id="group-fecha-cobro" class="input-group" style="display: none;">
                    <label>Fecha de Cobro Estimada</label>
                    <input type="date" id="venta-fecha-cobro">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">üíµ Finalizar Venta</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: REGISTRAR COBRO (DEUDA) -->
    <div id="modal-cobro" class="modal" style="display: none;">
        <div class="modal-content animate">
            <div class="modal-header">
                <h2>‚úÖ Registrar Pago</h2>
                <button onclick="UI.cerrarModal('modal-cobro')" class="btn-close">‚úñÔ∏è</button>
            </div>
            <div id="info-cobro" style="margin-bottom: 20px; text-align: center;">
                <p id="cobro-cliente" style="font-weight: 700; font-size: 1.2rem;"></p>
                <p id="cobro-monto" style="font-size: 2rem; color: var(--fresa); font-weight: 800;"></p>
            </div>
            <p style="font-size: 0.85rem; color: #777; margin-bottom: 20px;">¬øConfirmas que recibiste el pago de esta
                deuda? Esto actualizar√° tus resultados del periodo.</p>
            <div class="modal-actions">
                <button id="btn-confirmar-cobro" class="btn btn-success" style="width: 100%;">Confirmar Cobro</button>
                <button type="button" onclick="UI.cerrarModal('modal-cobro')" class="btn btn-link"
                    style="color:var(--texto); width: 100%; margin-top: 10px;">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: CLIENTE R√ÅPIDO -->
    <div id="modal-cliente-rapido" class="modal" style="display: none; z-index: 6000;">
        <div class="modal-content animate">
            <div class="modal-header">
                <h2>üë• Nuevo Cliente</h2>
                <button onclick="UI.cerrarModal('modal-cliente-rapido')" class="btn-close">‚úñÔ∏è</button>
            </div>
            <form id="form-cliente-rapido">
                <div class="input-group">
                    <label>Nombre</label>
                    <input type="text" id="rapido-nombre" placeholder="Nombre completo" required>
                </div>
                <div class="input-group">
                    <label>WhatsApp</label>
                    <input type="text" id="rapido-tel" placeholder="0424..." required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">‚úÖ Guardar Cliente</button>
                    <button type="button" onclick="UI.cerrarModal('modal-cliente-rapido')" class="btn btn-link"
                        style="color:var(--texto)">Regresar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: OPCIONES DE RESPALDO -->
    <div id="modal-respaldo" class="modal" style="display: none;">
        <div class="modal-content animate">
            <div class="modal-header">
                <h2>üíæ Respaldo de Datos</h2>
                <button onclick="UI.cerrarModal('modal-respaldo')" class="btn-close">‚úñÔ∏è</button>
            </div>
            <p>Actualmente tus datos est√°n <b>SOLO</b> en este tel√©fono.</p>
            <div class="alert-info"
                style="background:#FFF9C4; padding:15px; border-radius:15px; margin:15px 0; font-size:0.85rem; border-left: 5px solid #FBC02D;">
                ‚ö†Ô∏è Si borras el historial o pierdes el m√≥vil, <b>perder√°s tus cuentas y clientes</b>.
            </div>
            <p>Para mayor seguridad, conecta tu sistema a una hoja de <b>Google Sheets</b>.</p>
            <div class="modal-actions">
                <a href="https://wa.me/584245762885?text=Hola!%20Quiero%20activar%20el%20respaldo%20en%20la%20nube"
                    target="_blank" class="btn btn-whatsapp">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="18"> Solicitar
                    Activaci√≥n
                </a>
            </div>
        </div>
    </div>

    <!-- MODAL ONBOARDING -->
    <div id="modal-onboarding" class="modal" style="display: none;">
        <div class="modal-content animate">
            <h2>¬°Bienvenida! üç¶</h2>
            <p>Configura tu negocio para empezar:</p>
            <form id="form-onboarding">
                <div class="input-group">
                    <label>Nombre del Negocio</label>
                    <input type="text" id="on-nombre-negocio" placeholder="Ej: Yogures El Sol" required>
                </div>
                <div class="input-group">
                    <label>Tu Nombre</label>
                    <input type="text" id="on-nombre-due√±a" placeholder="Tu nombre" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Empezar
                    Ahora</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/services/bcv.js"></script>
    <script src="js/services/telemetria.js"></script>
    <script src="js/logic/calculadora.js"></script>
    <script src="js/logic/crm_logic.js"></script>
    <script src="js/logic/calendar_logic.js"></script>
    <script src="js/ui/handlers.js"></script>
    <script src="js/app.js"></script>
</body>

</html>